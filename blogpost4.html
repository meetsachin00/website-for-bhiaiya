<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./utils.css">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./blogpost.css">
    <link rel="stylesheet" href="./mobile.css">
    <title>iBlog - Heaven for bloggers</title>
    <link rel="stylesheet" href="./cheetsheet.css">
    <script src="./cheatsheet.js"></script>
</head>
<body>
    <nav class="navigation max-width-1 m-auto">
        <div class="nav-left">
            <a href="./index.html">
                <span><img src="./logo.png" width="94px" alt=""></span>
            </a>
            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="./contact.html">Contact</a></li>
            </ul>
        </div>
        <div class="nav-right">
            <form action="./search.html" method="get">
                <input class="form-input" type="text" name="query" placeholder="Article Search">
                <button class="btn">Search</button>
            </form>

        </div>

    </nav>
    <div class="max-width-1 m-auto">
        <hr>
    </div>
    <div class="post-img">
        <img src="./11.svg" alt="">
    </div>
    <div class="m-auto blog-post-content max-width-2 m-auto my-2">
        <!-- <h1 class="font1">The heaven for bloggers</h1> -->
        <div class="blogpost-meta">
            <div class="author-info">
                <div>
                <b>
                  Author - Neeraj
                </b>
                </div>
                <div>04 July. 6 min read</div>
            </div>
            <div class="social">

              <a href="https://www.youtube.com/channel/UCX6OQ3DkcsbYNE6H8uQQuVA  <svg width="29" height="29" class="hk"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a>

           <a href="https://www.youtube.com/channel/UCX6OQ3DkcsbYNE6H8uQQuVA">  <svg style="background: black;
                border-radius: 21px;" width="29" height="29" viewBox="0 0 29 29" fill="none" class="hk"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></a>  

                <svg width="29" height="29" class="hk"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg>

            </div>
        </div>
<h1>How to deploy flask app on Ubuntu VPS using Nginx and gunicorn</h1>

<p>In this post, we will see how to deploy flask applications using gunicorn WSGI server and nginx as a reverse proxy and static files server.</p>

<p>Follow the steps below:</p>

<h2>Step 1 - Install required packages</h2>

<pre class="language-js"><code>sudo apt update</code></pre>

<p>Now let's install python3, python3-pip, and Nginx using the commands below:</p>

<pre class="language-js"><code>sudo apt install python3-pip python3-dev nginx</code></pre>

<h2>Step 2 - Creating a directory (for our flask app) and virtual environment</h2>
<p>Let's install virtualenv</p>

<pre class="language-js"><code>sudo pip3 install virtualenv</code></pre>

<p>Lets now create a directory to host our flask application</p>

<pre class="language-js"><code>mkdir myFlaskApp && cd myFlaskApp</code></pre>
<p>run the following command to create a virtual environment named env</p>

<pre class="language-js"><code>virtualenv env</code></pre>
<p>Finally activate the virtual environment</p>
<pre class="language-js"><code>source env/bin/activate</code></pre>

<p>Lets now install flask and gunicorn using pip</p>
<pre class="language-js"><code>pip3 install flask gunicorn</code></pre>

<h2>Step 3 - Creating a sample project and wsgi entry point</h2>
<p>Let us now create a sample project by entering the command below:</p>
<pre class="language-js"><code>vim app.py</code></pre>
<p>Paste the contents below to app.py file</p>
<pre class="language-js"><code>from flask import Flask
app = Flask(__name__)
@app.route('/')
def hello_world():
    return "Hello World!"
if __name__ == '__main__':
    app.run(debug=True,host='0.0.0.0'</code></pre>

    <p>Next, we’ll create a file that will serve as the entry point for our application. This will tell our Gunicorn server how to interact with the application.</p>
<pre class="language-js"><code>vim wsgi.py</code></pre>
<p>copy the contents below to wsgi.py</p>
<pre class="language-js"><code>from app import app

  if __name__ == "__main__":
      app.run()</code></pre>
      <p>We can test gunicorn's ability to serve our project by running the command below:</p>
<pre class="language-js"><code>gunicorn --bind 0.0.0.0:5000 wsgi:app</code></pre>
<p>Folder structure so far:</p>
<pre class="language-js"><code>myFlaskApp
  |____ app.py
  |____ wsgi.py
  |____ env</code></pre>
  <p>Lets deactivate our virtual environment now:</p>
<pre class="language-js"><code>deactivate</code></pre>

<h2>Step 4 - Creating a systemd service</h2>

<p>Lets now create a systemd service using the following commands:</p>
<pre class="language-js"><code>vim /etc/systemd/system/app.service</code></pre>

<p>Now paste the contents below to this file:</p>
<pre class="language-js"><code>[Unit]
  #  specifies metadata and dependencies
  Description=Gunicorn instance to serve myproject
  After=network.target
  # tells the init system to only start this after the networking target has been reached
  # We will give our regular user account ownership of the process since it owns all of the relevant files
  [Service]
  # Service specify the user and group under which our process will run.
  User=harry
  # give group ownership to the www-data group so that Nginx can communicate easily with the Gunicorn processes.
  Group=www-data
  # We'll then map out the working directory and set the PATH environmental variable so that the init system knows where our the executables for the process are located (within our virtual environment).
  WorkingDirectory=/home/harry/myFlaskApp/
  Environment="PATH=/home/harry/myFlaskApp/env/bin"
  # We'll then specify the commanded to start the service
  ExecStart=/home/harry/myFlaskApp/env/bin/gunicorn --workers 3 --bind unix:app.sock -m 007 wsgi:app
  # This will tell systemd what to link this service to if we enable it to start at boot. We want this service to start when the regular multi-user system is up and running:
  [Install]
  WantedBy=multi-user.target</code></pre>
  <p>Activate this service by typing:</p>
<pre class="language-js"><code>sudo systemctl start app
  sudo systemctl enable app</code></pre>
  <p>A file named app.sock will be automatically created. Folder structure so far:</p>
<pre class="language-js"><code>myFlaskApp
  |____ app.py
  |____ wsgi.py
  |____ env
  |____ app.sock</code></pre>

  <h2>Step 5 - Configuring Nginx</h2>
  <p>Create a file named app inside /etc/nginx/sites-available</p>
<pre class="language-js"><code>vim /etc/nginx/sites-available/app</code></pre>
<p>Now copy the below contents to this file:</p>
<pre class="language-js"><code>server {
  listen 80;
  server_name 165.232.177.116;
  
  location / {
    include proxy_params;
    proxy_pass http://unix:/home/harry/myFlaskApp/app.sock;
      }
  }                </code></pre>
  <p><b>Important:</b> I have used my server IP, you should use yours!</p>
  <p>Activate this configuration by executing this:</p>
<pre class="language-js"><code>sudo ln -s /etc/nginx/sites-available/app /etc/nginx/sites-enabled</code></pre>
<p>Restart nginx and your website should work fine!</p>
<pre class="language-js"><code>sudo systemctl restart nginx</code></pre>
<p>Visiting http://165.232.177.116/ on browser shows a page like t</p>
<p>If you are using a firewall (for eg. ufw), don't forget to allow nginx to receive incoming traffic on port 80</p>
<pre class="language-js"><code>sudo ufw allow 'Nginx Full'</code></pre>
    </div>

    <div class="max-width-1 m-auto"><hr></div>
    <div class="home-articles max-width-1 m-auto font2">
      <h2>People who read this also read</h2>
      <div class="row">
          <!-- second article -->
          <div class="home-article more-post">
          
            <div class="home-article-img">
          <img src="./node js artcile.png" alt="">
          </div>
          
          
            <div class="home-article-content center font1">
              <a href="./blogpost2.html">
                <h3>How to deploy a Node.js application in production</h3>
              </a>
              <div>Author Name - Neeraj</div>
              <span>20 June | 6 min read</span>
            </div>
          </div>
          
          <!-- third article -->
          <div class="home-article more-post">
          
            <div class="home-article-img">
          <img src="./ubuntu.jpg" alt="">
          </div>
          
          
          <div class="home-article-content center font1">
              <a href="./blogpost3.html">
                <h3>How to install Ubuntu Desktop with Full GUI on an Ubuntu VPS</h3>
              </a>
            
              <div>Author Name - Neeraj</div>
              <span>20 June | 6 min read</span>
            </div>
          </div>
           
          <!-- 4 article -->
          <div class="home-article more-post">
          
            <div class="home-article-img">
          <img src="./flask.png" alt="">
          </div>
          
          <div class="home-article-content center font1">
              <a href="./blogpost4.html">
                <h3>How to deploy flask app on Ubuntu VPS using Nginx and gunicorn</h3>
              </a>
              <div>Author Name - Neeraj</div>
              <span>20 June | 6 min read</span>
            </div>
          </div>
          </div>
  </div>

    <div class="footer">
        <p>Copyright © ArticleWithNeeraj.com</p>

    </div>
</body>
</html>